-- LocalScript (StarterPlayerScripts)

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local flying = false
local speed = 50

game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end
    if input.KeyCode == Enum.KeyCode.F then -- กดปุ่ม F เพื่อบิน
        flying = not flying
        if flying then
            -- สร้าง BodyVelocity
            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.Parent = character
            bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bodyVelocity.Velocity = Vector3.new(0, speed, 0) -- บินขึ้น
            humanoid.WalkSpeed = speed
            humanoid.JumpPower = 0
        else
            -- ลบ BodyVelocity
            for _, obj in ipairs(character:GetChildren()) do
                if obj:IsA("BodyVelocity") then
                    obj:Destroy()
                end
            end
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
        end
    end
end)

game:GetService("RunService").RenderStepped:Connect(function()
    if flying then
        -- ควบคุมทิศทางการบิน
        local direction = Vector3.new(0, 0, 0)
        if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) then
            direction = direction + character.HumanoidRootPart.CFrame.LookVector
        elseif game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) then
            direction = direction - character.HumanoidRootPart.CFrame.LookVector
        end
        if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.A) then
            direction = direction - character.HumanoidRootPart.CFrame.RightVector
        elseif game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.D) then
            direction = direction + character.HumanoidRootPart.CFrame.RightVector
        end
        direction = direction.Unit * speed
        character:FindFirstChildOfClass("BodyVelocity").Velocity = direction
    end
end)
